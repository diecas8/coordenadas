<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertidor de Coordenadas</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <!-- Nuevos recursos para clusters y temas -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    
    <style>
        /* Tus estilos originales completos aquí */
        body { /* ... */ }
        h1 { /* ... */ }
        .container { /* ... */ }
        .card { /* ... */ }
        /* ... todos tus estilos originales ... */
        .file-input { margin-top: 10px; }

        /* ========== ESTILOS NUEVOS ========== */
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .card, #map { width: 100% !important; }
            #map { height: 300px; }
        }

        .theme-btn { 
            background: #444 !important; 
            margin-top: 10px; 
        }

        .search-btn { 
            background: #666 !important; 
            margin-top: 5px; 
        }

        .tema-oscuro { 
            background-color: #1a1a1a; 
            color: white;
        }
        /* ========== FIN ESTILOS NUEVOS ========== */
    </style>
</head>
<body>
    <h1>Convertidor de Coordenadas</h1>

    <div class="container">
        <div class="card">
            <h2>Introducir Coordenadas</h2>
            <!-- Botones nuevos agregados aquí -->
            <button class="theme-btn" onclick="cambiarTema()">🌞/🌙</button>
            <input type="text" id="buscador" placeholder="Buscar lugar...">
            <button class="search-btn" onclick="buscarLugar()">🔍</button>

            <label for="latitude">Latitud:</label>
            <input type="text" id="latitude" placeholder="Ejemplo: 1.757537">
            <!-- ... resto de tus elementos originales ... -->
            <button onclick="convertCoordinates()">Convertir y Mostrar</button>
            <button class="gps-btn" onclick="getCurrentLocation()">Capturar Ubicación Actual</button>
            <label for="geojson-file" class="file-input">Cargar GeoJSON:</label>
            <input type="file" id="geojson-file" accept=".geojson" onchange="handleGeoJSONUpload(event)">
        </div>

        <div id="map"></div>
    </div>

    <!-- ... tu tabla y footer originales ... -->
    <div class="history-container">
        <table id="historyTable">
            <!-- ... tabla original ... -->
        </table>
        <button class="export-btn" onclick="exportToExcel()">Exportar a Excel</button>
        <button class="clear-btn" onclick="clearHistory()">Limpiar Historial</button>
    </div>

    <div class="footer">
        <p>Elaborado por Diego Castaño</p>
    </div>

    <script>
        // Tu código JavaScript original completo aquí
        let map;
        let markers = [];
        let historyCount = 0;
        const savedHistory = JSON.parse(localStorage.getItem('history')) || [];

        // ========== NUEVO: INICIALIZACIÓN DE MAPA CON CAPAS ==========
        function initializeMap() {
            map = L.map('map').setView([0, 0], 2);

            const capasBase = {
                "Google": L.tileLayer('https://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
                    maxZoom: 20,
                    subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
                    attribution: '© Google Maps'
                }),
                "Satélite": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')
            };
            
            capasBase.Google.addTo(map);
            L.control.layers(capasBase).addTo(map);

            const marcadoresCluster = L.markerClusterGroup();
            map.addLayer(marcadoresCluster);

            // ... resto de tu código original de inicialización del mapa ...
        }
        // ========== FIN NUEVA SECCIÓN ==========

        // ========== NUEVA VALIDACIÓN EN TIEMPO REAL ==========
        document.getElementById('latitude').addEventListener('input', function() {
            this.style.borderColor = this.value > 90 || this.value < -90 ? "red" : "green";
        });
        
        document.getElementById('longitude').addEventListener('input', function() {
            this.style.borderColor = this.value > 180 || this.value < -180 ? "red" : "green";
        });
        // ========== FIN VALIDACIÓN ==========

        // ... todas tus funciones originales: getSiteName, convertCoordinates, etc ...

        // ========== NUEVA FUNCIÓN TEMA OSCURO ==========
        function cambiarTema() {
            document.body.classList.toggle('tema-oscuro');
        }
        // ========== FIN FUNCIÓN TEMA ===========

        window.onload = initializeMap;
    </script>
</body>
</html>
